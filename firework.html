

<!DOCTYPE HTML>
<html>

<head>
<meta charset="UTF-8">
<title>Fireworks</title>
<style type="text/css">

/* basic browser reset */
* {
  margin: 0;
  padding: 0;
}

body {
  overflow: hidden;
}


</style>

</head>

<body>
<canvas></canvas>

<script type="text/javascript">
var canvas = document.querySelector('canvas');

window.addEventListener('resize', function(event){
  canvas.height = window.innerHeight;
  canvas.width = window.innerWidth;
});

	// VARIABLEZ
	// play with them
	var c = document.querySelector('canvas'),
		ctx = c.getContext('2d'),
		width = c.width = window.innerWidth,
		height = c.height = window.innerHeight,

		fw1, fw2, fw3, fw4, //firework objects
		minStrength = 2, //lowest firework power
		maxStrength = 4, //highest firework power
		minTrails = 7, //min particles
		maxTrails = 30, //max particles
		particleRadius = 1,
		trailLength = 25, //particle trail length
		delay = 1 , // number of LIFEs between explosions

		LIFE = 100, //life time of firework

		g = 5e-2, //strength of gravity
		D = 1e-3; //strength of drag (air resistance)

var refresh;
var mouse = {
  x: undefined,
  y: undefined
}

window.addEventListener('mousemove', function(event){
  mouse.x = event.x;
  mouse.y = event.y;
});

window.addEventListener('mousedown', function(){
  fw3 = new FireworkMouse;
  refresh = setInterval(newF, delay * 1000);
});

window.addEventListener('mouseup',function(){
  clearInterval(refresh);
});

function newF(){
  if (fw3.life !== 0) {
    fw4 = new FireworkMouse;

  }
  fw3 = new FireworkMouse;

}


// Particle Class
var Particle = function(x, y, vx, vy, ax, ay, color) {
		this.x = x;
		this.y = y;
		this.vx = vx;
		this.vy = vy;
		this.ax = ax;
		this.ay = ay;
		this.life = LIFE; //only here for opacity in .draw() method
		this.path = [];
		this.color = color;
		this.r = particleRadius;

		this.update = function() {
			this.life--;

			// add point to path but if full, remove a point first
			if (this.path.length >= trailLength) this.path.shift();
			this.path.push([this.x, this.y])

			// update speed n position n stuff
			this.vy += this.ay;
			this.vx += this.ax;
			this.x += this.vx;
			this.y += this.vy;
		}

		this.draw = function() {
			var opacity = ~~(this.life * 100 / LIFE) / 100;

			// tail
			ctx.fillStyle = 'rgba(' + this.color + (opacity * 0.4) + ')';
			if (this.life > LIFE * 0.95) ctx.fillStyle = '#fff';
			ctx.lineWidth = 1;
			ctx.beginPath();
			ctx.moveTo(this.x - this.r, this.y);
			var i = this.path.length - 1;
			ctx.lineTo(this.path[0][0], this.path[0][1]);
			ctx.lineTo(this.x + this.r, this.y);
			ctx.closePath();
			ctx.fill();

			// main dot
			ctx.fillStyle = 'rgba(' + this.color + opacity + ')';
			if (this.life > LIFE * 0.95) ctx.fillStyle = '#fff';
			ctx.beginPath();
			ctx.arc(~~this.x, ~~this.y, this.r, 0, Math.PI * 2);
			ctx.fill();
			ctx.closePath();
		}
	}

  // Firework class
  var Firework = function() {
    this.x = width * (Math.random() * 0.8 + 0.1); // from 0.1-0.9 widths
    this.y = height * (Math.random() * 0.8 + 0.1); // from 0.1-0.9 heights
    this.strength = Math.random() * (maxStrength - minStrength) + minStrength;
    this.color = ~~(Math.random() * 255) + ',' +
                 ~~(Math.random() * 255) + ',' +
                 ~~(Math.random() * 255) + ',';
    this.life = 0;

    this.particles = (function(x, y, strength, color) {
      var p = [];
      var n = ~~(Math.random() * (maxTrails - minTrails)) + minTrails;
      var ay = g;

      for (var i = n; i--;) {
        var ax = D;
        var angle = i * Math.PI * 2 / n;
        if (angle < Math.PI) ax *= -1;
        var vx = strength * Math.sin(angle);
        var vy = strength * Math.cos(angle);
        p.push(new Particle(x, y, vx, vy, ax, ay, color));

      }

      return p;
    })(this.x, this.y, this.strength, this.color);

      this.update = function() {
        this.life++;
        if (this.life < 0) return; //allows life to be delayed
        for (var i = this.particles.length; i--;) {
          this.particles[i].update();
          this.particles[i].draw();
          //wasn't bothered to make an extra draw function for firework class
        }
      }
  };

    // Firework mouse class
  var FireworkMouse = function() {
  		this.x = width * (Math.random() * 0.8 + 0.1); // from 0.1-0.9 widths
  		this.y = height * (Math.random() * 0.8 + 0.1); // from 0.1-0.9 heights
  		this.strength = Math.random() * (maxStrength - minStrength) + minStrength;
  		this.color = ~~(Math.random() * 255) + ',' +
  			~~(Math.random() * 255) + ',' +
  			~~(Math.random() * 255) + ',';
  		this.life = 0;

  		this.particles = (function(x, y, strength, color) {
  			var p = [];
  			var n = ~~(Math.random() * (maxTrails - minTrails)) + minTrails;
  			var ay = g;

  			for (var i = n; i--;) {
  				var ax = D;
  				var angle = i * Math.PI * 2 / n;

  				if (angle < Math.PI) ax *= -1;
    				var vx = strength * Math.sin(angle);
    				var vy = strength * Math.cos(angle);
    				p.push(new Particle(mouse.x, mouse.y, vx, vy, ax, ay, color));
  			}

  			return p;
  		})(this.x, this.y, this.strength, this.color);

  		this.update = function() {
  			this.life++;
  			if (this.life < 0) return; //allows life to be delayed
  			for (var i = this.particles.length; i--;) {
  				this.particles[i].update();
  				this.particles[i].draw();
  				//wasn't bothered to make an extra draw function for firework class
  			}
  		}
  	};

	function main() {
		ctx.fillStyle = 'rgba(0,0,0,0.5)';
		ctx.fillRect(0, 0, width, height);

		fw1.update();
		fw2.update();
    fw3.update();
    if (fw4) {
      fw4.update();
    }


		if (fw2.life == LIFE * delay) fw1 = new Firework;
		if (fw1.life == LIFE * delay) fw2 = new Firework;

		window.requestAnimationFrame(main);
	}

	function init() {
		fw1 = new Firework;
		fw2 = new Firework;
		fw2.life = -LIFE * delay;
    fw3 = new FireworkMouse;
		main();
	}

init();

    </script>
  </body>
</html>
